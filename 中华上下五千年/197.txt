雁门郡马邑县的豪强之士聂壹，通过大行王恢向武帝建议：“匈奴刚刚与汉和亲结好，亲近信任边境吏民，可用财利引诱他们前来，汉军预设伏兵袭击，这是肯定会打败匈奴人的妙计。”武帝采纳了王恢的主张。

	 

	汉武帝任命御史大夫韩安国为护军将军，卫尉李广为骁骑将军，太仆公孙贺为轻车将军，大行王恢为将屯将军，太中大夫李息为材官将军，统率战车、骑兵、步兵共三十多万人暗中埋伏在马邑附近的山谷中，约定等单于进入马邑就挥军出击。

	 

	汉军暗地派聂壹当间谍，逃到匈奴人那儿，聂壹对单于说：“我能杀马邑县的县令和县丞，献城归降，您可以得到全城的所有财物。”单于很喜欢和信任聂壹，认为他说得对，就同意了他的计划。聂壹返回马邑县城，就斩杀死刑囚犯，用来假冒县令、县丞，把他们的头挂在马邑城下，让单于的使者观看说：“马邑县的长官已经死了，你们可以赶快来！”于是，单于越过边塞，统率十万骑兵进入武州塞。走到距离马邑县城还有一百多里的地方，单于见牲畜遍野，却没有一个放牧的人，感到奇怪。就派人攻打亭隧，俘虏了雁门郡的尉史，要杀掉他，这个尉史就告诉单于汉兵埋伏的地点。单于大吃一惊，立刻领兵撤退，在撤出汉境之后，单于说：“我俘虏了这个尉史，是上天保佑我啊！”就称尉史为“天王”。

	 

	边塞守军传报单于已率军退走，汉军追到边塞，估计追不上了，就全军撤回。王恢指挥另一支军队，从代地出发，准备袭击匈奴的后勤给养，听说单于返回，军队很多，也不敢出击。一个小人物坏了一件大事啊！