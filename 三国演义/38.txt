诸葛亮于是统兵二十万，只领十万出祁山，另一班兵马在后预备，百日为期，循环替换。司马懿闻信，便命张郃为前部先锋去守祁山，自己与郭淮巡守陇西天水诸郡，以防蜀兵偷割小麦。

	 

	诸葛亮到了祁山，安营已毕，果然便要去割陇西小麦。得知司马懿已有防备，诸葛亮吃了一惊，便命人推来在蜀中造好的三辆四轮车，装饰停当；又命各将引军分别准备。魏兵见诸葛亮出阵，忙报与司马懿。司马懿出营一看，只见诸葛亮手摇羽扇，端坐车上；左右二十四人，披发仗剑；前面一人，手执黑旗，俨然天神一般。司马懿笑道：“诸葛亮又在装神弄鬼了。”便命把诸葛亮连人带车一同捉来。魏兵赶去，却赶不上；魏兵停下，诸葛亮又回车过来。魏兵不敢再追。

	 

	忽然左边鼓声大震，一彪军杀来。队里二十四人，披发仗剑，拥出一辆四轮车来：车上端坐诸葛亮。司马懿大惊道：“如何这里又有一个诸葛亮！”话音未落，右边鼓声又鸣，一彪军杀来，也有二十四人拥着诸葛亮。魏兵心中大乱，不敢交战，各自奔走。

	 

	忽然鼓声大震，又一彪军杀来：当先一辆四轮车上，端坐诸葛亮。司马懿不知是人是鬼，十分惊惧，又不知多少蜀兵，不敢交战，忙领兵回营，闭门不出。此时诸葛亮早已令三万精兵将陇上小麦割尽，运到卤城区打晒去了。司马懿三日不敢出城，直到蜀军退去，才敢命军士出来打探。魏兵抓到一个割麦走失的蜀兵，一问，才知先前四辆车上，只有第一辆车上是诸葛亮。司马懿后悔莫及，便与郭淮商议当夜去攻卤城。诸葛亮料定司马懿定要前来攻城，便命姜维、魏延、马岱等将引兵，在城周围麦田中埋伏，只听炮响，四角一齐杀出。诸葛亮也引百余人，各带火炮，伏在麦田中等候。

	 

	司马懿到了城下，天已昏黑。正要攻城，忽然城上万弩齐发，城下火炮齐鸣，四角杀声大振。城中蜀兵也是乘势冲出，里应外合，魏兵死伤无数。诸葛亮得胜收兵，料想司马懿必定要断剑阁粮道，便命姜维、马岱先去守住险要。此时蜀兵百日期满，诸葛亮便命一半军士起程，回蜀中换班。忽报孙礼引西凉兵二十万前来助魏，杨仪劝诸葛亮暂且留下士兵，等新来兵到，再令回蜀。诸葛亮不肯，命士卒急速起程。众军见丞相如此仁义，都愿死战。诸葛亮便命各部兵马，等魏兵一到，不容喘息，火速进攻。西凉兵远来疲惫，蜀军人人奋勇，直杀得魏兵尸横遍地，血流成河。

	 

	诸葛亮得胜，正在庆功，忽得报永安太守李严有书告急。诸葛亮拆信一看，见信中称东吴将乘虚来袭。诸葛亮虽然惊疑，也只得退兵。

	 

	张郃见蜀军退兵，便自告奋勇，引兵来追。诸葛亮早已在剑阁伏下弓弩手，将张郃及百余部将一齐射死在木门道中。

	 

	诸葛亮回到成都，方知东吴并无动静。原来是李严备办军粮不及，怕丞相降罪，谎报军情。诸葛亮大怒，便将李严削去官职。

	 

	三年之后，蜀中粮草丰足，诸葛亮又引兵三十四万，六出祁山。司马懿领军四十万，来拒诸葛亮。

	 

	诸葛亮此番出兵祁山，下了五个大寨；又在斜谷至剑阁一带，连下十四个大寨，分屯兵马，作长久之计。诸葛亮见郭淮、孙礼在北原下寨，守陇西一路，便派兵暗取渭水之南。司马懿识破，蜀兵大败一阵。诸葛亮又修书孙权，让东吴起兵伐魏。诸葛亮见粮草转运不便，便画了图纸，让士兵制造“木牛”“流马”。过了数日，木牛流马皆造完毕，宛然活的一般，上山下岭，十分方便。众军见了，无不欢喜。诸葛亮便命高郑引一千军士驾着木牛流马，自剑阁至祁山大寨，往来搬运粮草。

	 

	司马懿闻讯大惊，急唤张虎引军去抢得几匹；令巧匠百余人，将木牛流马拆开，依其尺寸厚薄，依样制造。不到半月，造成两千余只。司马懿便命岑威引一千军士，去陇西搬运粮草。诸葛亮得知，不忧反喜，便命王平引一千军士，扮成魏兵，前去劫粮；又命魏延、姜维、马岱等人依计行事。

	 

	岑威引军驾着木牛流马，装载粮米。正行间，忽得报前面有大军前来接粮。岑威大喜，两军合在一处。忽然喊声大震，蜀兵就在军中杀起，大呼：“蜀中大将王平在此！”魏兵措手不及，被杀死大半，岑威也被王平一刀砍了。

	 

	郭淮得知军粮被劫，急引军来救。王平命士兵将木牛流马扭转舌头，放在路上，边战边走。郭淮也不追赶，只命士兵驾木牛流马，却哪里赶得动？正在疑惑，两边喊声大起，魏延、姜维杀出，郭淮大败。司马懿得知北原兵败，引军来救。刚到半路，忽然一声炮响，张翼、廖化从两边杀出。司马懿大惊。魏军着慌，各自逃命。蜀兵又将木牛流马舌头扭转，都驾走了。

	 

	司马懿从此坚守不出，任蜀军百般叫阵。诸葛亮便命蜀兵与魏民杂处，各自种田，并不侵犯。夏侯和、夏侯惠道：“蜀军各处屯田，作长久之计。如不及时除去，恐怕日后根深蒂固，难以摇动。”便要引军出战。司马懿也便应允。

	 

	半月之间，夏侯兄弟截杀运粮蜀军，连胜数阵。司马懿审问俘来蜀兵，得知诸葛亮在上方谷安营，囤积粮草。司马懿大喜，命诸将猛攻祁山大寨，自己引兵来取上方谷。诸葛亮见魏兵行动，便命众将准备去劫渭南魏寨。

	 

	魏兵来攻祁山大营，蜀兵四下奔走。司马懿便与司马师、司马昭引中军人马杀奔上方谷。到了谷口，正遇魏延，杀了一阵，魏延不敌。司马懿命人打探，回报谷内并无伏兵，山上都是草房。司马懿心想，果然是囤粮之地，便全力攻进。进了谷中，忽然不见了魏延。司马懿大惊。只听喊声震天，山上一齐丢下火把来，烧断谷口。一时火势冲天，魏兵奔逃无路。

	 

	司马懿惊得手足无措，下马抱住二子哭道：“我父子三人皆死此处矣！”

	 

	忽然狂风大作，一声霹雳响，骤雨倾盆。满谷之火，尽被浇灭。司马懿大喜，引军杀出。张虎等人也来接应。王平兵少，不敢追赶。

	 

	诸葛亮在山上，见司马懿被困谷中，心中甚喜，以为司马懿此番必死。不料天降大雨，诸葛亮叹道：“谋事在人，成事在天。实在是不能勉强啊！”