大宛的形迹，是从张骞时开始发现了解的。张骞，是汉中人，建元年间被选为郎官。当时天子向投降的匈奴人询问情况，都说匈奴将月氏王打败，用他的头颅当作饮酒的器皿，月氏人逃得很远，心中一直对匈奴非常怨恨，但是没有人和他们联合起来攻打匈奴。当时汉朝正打算灭掉匈奴，听到了这些情况，就想派使者联系月氏人。但是，前往月氏必须要经过匈奴境内，于是朝廷就招募一位能够担当使者的人。张骞便以郎官的身份去应征，被派出使月氏，他和堂邑侯家的一个名叫甘父的匈奴奴隶一起从陇西出发了。在路过匈奴境内的时候，他们被匈奴人抓住，送到了单于那里。单于将他们扣留，说道：“月氏在我的北面，汉朝怎么能派使者去呢？我想派人出使越池，汉朝能听任我这样做么？”就这样张骞被匈奴扣留羁押了十多年，匈奴人给他娶妻，还生了儿子，但是张骞手握汉朝的节杖没有失去。

在匈奴居留期间，匈奴对他的看管越来越松，张骞于是就抓住一个机会，带着随从逃往月氏。他们向西走了几十天，终于到了大宛。大宛王早就听说过汉朝物产富饶，想要和汉朝来往但却一直没能如愿，因此他见了张骞很高兴，就问他道：“你要到哪里去？”张骞回答：“我作为汉朝的使者要出使月氏，却被匈奴人扣留。如今我逃了出来，希望大王您派人为我引路，送我去月氏。如果我能到那里，在返回汉朝之后，汉朝肯定会送给您数不胜数的财物。”大宛王表示赞同，就派人一路护送张骞前往康居，同时还安排了向导和翻译。到达康居后，康居又辗转将张骞送到大月氏。当时大月氏王已经被匈奴所杀，他的太子被立为王。将大夏国征服以后，月氏人在那里定居下来，那里土地肥沃，物产丰富，又很少有贼寇，百姓安居乐业，大月氏王认为自己离汉朝太远了，所以没有一点儿想向匈奴复仇的意思。张骞从月氏到大夏，没能掌握月氏的真正动向。

张骞在月氏停留了一年多，然后回国。他沿着南山东行，打算从羌人地区穿过回到长安，但是又被匈奴人抓住。他又在匈奴滞留了一年多，单于去世了，左谷蠡王出兵攻打单于的太子，自立为单于。匈奴发生了内乱，于是张骞带着自己的匈奴妻子还有堂邑父一同逃回了汉朝。汉朝任命张骞为太中大夫，堂邑父为奉使君。

张骞为人坚强有毅力，待人宽厚，让人信服，所以蛮夷人都喜欢他。堂邑父原本是胡人，擅长射箭，陷入困顿的时候就射些飞禽走兽充饥。当初，张骞出发的时候有一百多人，离开十三年，只有他和堂邑父两人回来了。

张骞亲自去过的地方有大宛、大月氏、大夏、康居，还听说这些国家周围还有五、六个大国，他把这些情况一一向天子汇报。张骞说：

大宛在匈奴的西南方，在汉朝的正西方，距离汉朝约有一万里。他们的习俗是定居，耕田，种植稻和麦。酿有葡萄酒。当地出产良马，马出汗如血，它们的祖先是天马之子。他们那里建有城镇和住屋。归属于大宛的城池大大小小有七十多座，百姓约有几十万。他们使用的兵器是弓和矛，擅长骑马射箭。大宛的北边是康居，西面是大月氏，西南边是大夏，东北边是乌孙，东面是扜罙、于窴。于窴的西边，水都向西流，注入青海湖；于窴东边的水则都向东流，注入盐泽。盐泽的水在地下潜行，它的南边就是黄河的源头。那里盛产玉石，黄河水流向中原。楼兰、姑师这些地方都建有城郭，靠近盐泽。盐泽距离长安约有五千里。匈奴的右翼占据着盐泽以东的土地，一直到陇西长城，南边和羌接壤，阻住了汉朝西去的道路。

乌孙位于大宛的东北约二千里的地方，那里的人民不定居，过着游牧的生活，和匈奴的习俗相同。有几万名弓箭手，勇勐善战。以前乌孙臣服匈奴，后来逐渐强大了起来，就和匈奴保持著名义上的隶属关系，却再也不愿去朝拜匈奴了。

康居位于大宛西北边大约二千里的地方，那里的人民不定居，在习俗上和大月氏基本相同。有八九万名弓箭手，和大宛国相邻。国家很小，南边臣服于月氏，东边臣服于匈奴。

奄蔡位于康居西北方大约二千里的地方，那里的人民不定居，和康居的习俗基本相同。有十余万弓箭手，紧邻一望无际的大洼地，没有山崖，大概那就是北海吧。

大月氏位于大宛西边约二三千里的地方，靠近妫水的北面。它的南边是大夏，西边是安息，北边是康居。百姓不定居，跟随牲畜迁徙，和匈奴风俗相同。约有一二十万弓箭手。大月氏曾经很强大，轻视匈奴，等到冒顿被拥立为单于时，匈奴打败了月氏。到了老上单于时，匈奴将月氏王杀死，用他的头颅作为饮酒器皿。原本月氏在敦煌、祁连之间生活，后来为匈奴打败，于是迁到更远的地方，经过宛，向西进攻大夏并使它臣服，于是就在妫水的北面建都，并设立王庭。没有跟着西行的一小部分人，留下来守卫着南山和羌人居住的地方，被称为小月氏。

安息位于大月氏西边约几千里的地方。那里的百姓过着定居的生活，耕田，种植稻和麦，酿有葡萄酒。安息的城镇和大宛一样。附属于它的城镇大大小小有几百座，国土方圆几千里，是最大的国家。安息紧挨着妫水，有集市，百姓经商用车辆和船只运送货物到附近的国家甚至是几千里以外的地方。安息这个国家用银作为货币，钱币上铸有国王的肖像，国王死了就要更换钱币，再铸上新国王的肖像。在皮革上横着写书信、做记录。安息的西边是条枝，北边有奄蔡、黎轩。

条枝位于安息西面几千里的地方，临近西海。气候炎热、潮湿。百姓从事农耕，种植水稻。那里出产一种大鸟，产的蛋大如酒瓮。人口很多，一般有小君主，在安息的役使管辖之下，将它们视为外围国家。条枝的国人擅长魔术。安息长老相传条枝有弱水、西王母，但是从来没有见过。

大夏位于大宛西南面二千多里的地方，在妫水的南边。那的百姓过着定居的生活，建有城郭住屋，和大宛的习俗相同。这里也没有大君主，往往是在城邑设有小君主。这个国家军事力量很弱小，害怕打仗。这里的人善于经商。后来大月氏西迁的时候，将它打败，又统治了整个大夏国。大夏人口很多，大约有一百多万。大夏的国都叫蓝市城，有贩卖各种货物的集市。大夏国的东南边有身毒国。

张骞说：“我在大夏的时候曾经见到邛地的竹杖、蜀地的布料。我问他们说：‘怎么得到的这些东西？’大夏国的人说：‘我们的商人去身毒买的。身毒位于大夏东南面约几千里。那儿百姓过着定居的生活，习俗和大夏基本相同，并且地势低平，气候潮湿、炎热。那里的人骑着大象作战。那个国家国土紧靠着一条大河’。根据我的推测，大夏距离汉朝一万二千里，在汉朝的西南边。现在身毒国又在大夏东南面几千里，那里有蜀地的物产，那么它与蜀郡相距不会太远。如今出使大夏，从羌人居住区经过，道路难行，羌人又厌恶这样的做法；要是稍稍偏北一些，恐怕会被匈奴人抓住；从蜀郡走应该是最为方便的路，而且没有强盗。”天子听说大宛和大夏、安息这些都是大国，有很多奇珍异宝，百姓过着定居的生活，与汉朝人的生活很相像，同时军事力量又很薄弱，又希望得打汉朝的财物；北边的大月氏、康居这些国家，军队强大，可以通过馈赠利诱来让它们朝拜。况且如果真的能通过道义让它们归属，又能够开拓万里疆土，经过多重翻译，招致风俗各异的国家，汉朝天子的声威和恩德就会遍及四海。天子很高兴，认为张骞的话很有道理，就命令张骞从蜀郡的犍为秘密派出使者，分四路同时出发：一路从駹出发，一路从冉出发，一路由徙起程，一路由邛、僰起程，每一路都行走一二千里。结果北方那一路受阻于氐、筰，南方那一路受阻于嶲、昆明。昆明那里没有君主，强盗横行，常常杀害、掠夺汉朝的使者，汉朝使者最终没有能够通过。但是，听说昆明西边约一千多里地方，有个骑象的国家，名叫滇越，而蜀地的商人私下偷运货物出境贩卖时，有人去过那里，于是汉朝为了寻找通往大夏的道路，就开始和滇国往来。当初，汉朝曾经想过和西南夷沟通，但是因为花费太多，道路又不畅通，于是只好作罢。等张骞说可以由此沟通大夏时，又再次开始经营沟通西南夷了。

张骞以校尉的身份跟随大将军卫青征讨匈奴，因为他知道哪里有水草，军队因此不会陷于困乏，于是张骞被封为博望侯。这一年是元朔六年（前123年）。第二年，张骞担任卫尉，和李广将军一同从右北平出发去攻打匈奴。匈奴军队围攻李广，李广军队损失惨重；而张骞的军队因为耽误了时间而后至，按律应当被斩首，他花钱赎罪，被贬为庶民。那一年，汉朝派骠骑将军霍去病大败匈奴西域的军队几万人，兵至祁连山下。第二年，浑邪王率领属下百姓投降汉朝，从这以后，金城、河西的西边一直到盐泽一带再也看不到匈奴人的踪迹了。有的时候匈奴会派出侦察兵来，但是这样的情况也很少。这以后的两年，汉朝军队又在漠北赶走了匈奴单于。

这以后，天子多次向张骞询问与大夏有关的事。当时张骞已经失去侯爵，于是说道：“我在匈奴的时侯，听说乌孙王号昆莫，昆莫的父亲是匈奴西边一个小国的国王。匈奴人杀死了他的父亲时，昆莫刚刚出生就被抛弃在野外。乌鸦叼着肉在他的上空飞翔，狼跑去给他哺乳。匈奴单于觉得非常奇怪，以为他是神，于是就收养了他，将他抚养成人。他成年以后，单于又让他领兵打仗，屡有战功，单于又将原来属于他父亲的百姓分给他统领，让他长久地戍守在西边。昆莫聚集他的部众，攻占附近的小城镇，手下有几万名弓箭手，作战娴熟。匈奴单于死后，昆莫就率领部众向远处迁徙，保持中立，不愿再去朝拜匈奴。匈奴发动奇兵攻打昆莫，没有获胜，就以为昆莫有神灵相助而远远地避开了他，对他还是用笼络的手段来保持名义上的隶属关系，也不再发动大的进攻了。现在匈奴单于刚为汉朝所困，而原来浑邪王的领地又没人守卫。蛮夷的习俗向来是贪图汉朝的财物，如果我们现在趁这个时机送给乌孙王大量的金银，招引他一点点东迁，在原属浑邪王的土地上居住，和汉朝结为兄弟，从情势上看，他应该能同意的，如果他同意，就是将匈奴右臂膀斩断了。只要联合上了乌孙，那么它以西的大夏等国都可以招来而作为藩臣。”天子认为他说的有道理，就任命张骞为中郎将，率领三百人，每人两匹马，几万只牛羊，带着价值几千万的钱财、布帛，同时派出很多持节杖的副使，如果道路可通，就派他们到附近的国家出使。

张骞到了乌孙后，乌孙王昆莫接见汉朝使者时采用的是拜见匈奴单于的礼节，张骞心中羞愧且愤怒，他清楚蛮夷的天性就是贪婪，于是说道：“天子赠送礼物，大王如果不拜谢，那就把礼物退回来。”于是昆莫起身拜谢赏赐，其余的还是一样。张骞将自己这次出使的意图和昆莫说了：“如果乌孙能够向东迁徙到浑邪王的土地上，那么汉朝就将一位诸侯的女儿嫁到昆莫做夫人。”当时乌孙国已经分裂，国王年纪又大，又与汉朝相距太远，并不清楚汉朝的大小，他们臣服于匈奴时间已久，与匈奴相距很近，他们的大臣都很惧怕匈奴，不愿迁走，国王自己做不了决定。就这样，张骞没有得到昆莫的明确表态。昆莫有十多个儿子，其中一个儿子叫大禄，很强悍，善于率领部众，他带领一万多骑兵在别处驻扎。大禄的哥哥是太子，太子有个儿子叫岑娶，而太子很早就去世了。他临死时对父亲昆莫说：“一定要立岑娶为太子，不可以让别人替代他。”昆莫很悲伤，就答应了他，最终立岑娶为太子。大禄因为自己没有被立为太子而愤怒，于是就联合诸多兄弟，率领部下造反了，打算进攻岑娶和昆莫。昆莫年纪大了，总是担心岑娶被大禄杀害，于是分给岑娶一万多骑兵，让他去别处驻扎，而昆莫还有一万多骑兵用以自保，他的国家、百姓就这样被一分为三，大体名义上还是都归属于昆莫，因此昆莫也不敢单独做主，和张骞定约。

于是张骞又分别派出副使出使大宛、康居、大月氏、大夏、安息、身毒、于窴、扜<生僻字>以及周边的国家。乌孙国派出向导和翻译送张骞回国，张骞和乌孙派出的使者几十人，几十匹马回国答谢，也趁这个机会让他们看看汉朝，了解汉朝的强大。

张骞返回朝廷，被任命为大行，位列九卿。一年多以后，张骞去世。

乌孙的使者看到汉朝人口众多、物产丰富，回去之后报告给国王，于是乌孙国对汉朝更重视了。这以后一年多，张赛派出使大夏等国的使者，渐渐开始和其他国家的人一同回来，于是西北各国开始和汉朝有了来往。由于这种互通往来是张骞开创的，因此以后出使西域的人都自称“博望侯”，以此来取得外国的信任，而外国也因此而信任他们。

自从博望侯张骞去世以后，匈奴听说汉朝和乌孙互通往来，非常生气，打算攻打乌孙。等到汉朝出使乌孙，并且还从乌孙的南部出发，连续不断到达大宛、大月氏等国，乌孙于是害怕起来，派出使者向汉朝进献马匹，希望能够娶一位汉朝诸侯的女儿并结成兄弟之国。天子向大臣们征求意见，大臣们都说“一定要先让他们送上聘礼，然后才可以把诸侯女儿嫁过去”。起初，天子打开《易》进行占卜，卜辞上说“神马当从西北来”。汉朝得到了乌孙的好马，将其命名为“天马”。后来又得到了大宛的汗血马，比乌孙马更加健壮，于是就将乌孙马改名为“西极”，将大宛马命名为“天马”。这时，汉朝开始修筑令居以西的长城，又设置酒泉郡，开通和西北各国的交往。又派出更多的使者出使安息、奄蔡、黎轩、条枝、身毒各国。而天子特别喜欢大宛马，于是出使大宛的使者更是络绎不绝。那些出使外国的使者，人数多的有几百人，人数少的也有一百多人，人们所携带的东西与博望侯张骞那时大致相同。后来次数多了也就越来越熟悉了，人数也随之渐渐减少。一年中汉朝要派出去的使者，多的时候有十几次，少的时候也有五六次。去远的地方，使者得八九年回来，近的地方也要几年才返回。

当时汉朝已经将南越灭掉，蜀、西南夷都震惊不小，纷纷派出官员入朝表示诚意。于是汉朝设置了益州、越西、牂柯、沈黎、汶山郡，希望土地相连直到大夏。于是汉朝每年派出包括柏始昌、吕越人等人在内的使者一年有十几次，从这几个新设的郡出发前往大夏，但是又都被昆明阻拦，使者被杀，钱物被抢，终究没能到达大夏。汉朝于是征发三辅的囚犯，加上巴蜀几万名士兵，派郭昌、卫广两位将军，前去攻打昆明拦杀汉朝使者的人，汉军杀死和俘虏几万人后就撤走了。以后汉朝又派出使者，昆明依旧劫掠杀害，通往大夏的道路最终也没打通。而北边取道酒泉去大夏的使者已经很多，外国人对汉朝的布帛财物也越来越厌恶了，不再重视这些东西。

自从博望侯张骞凭借打通和外国的来往道路而尊贵起来，那些后来跟着出使的官吏和士兵争相上书，讲述外国的奇闻异事和奇珍异宝，请求出使。天子认为外国路途遥远，不是每个人都愿意去的，于是就接受他们的要求，颁给他们使者的符节，招募官吏和百姓时也不再问他们的出身，让他们聚集人手便派他们前往，广开出使外国的门路。那些往来出使的人不能不做下侵吞布帛财物的事情，有的甚至背离了出使的宗旨，天子因为他们熟悉西域情况，所以通常就深究他们的罪行判成重罪，以激励他们再次出使来立功赎罪。这样一来，出使的事端无穷无尽，他们也很轻率地就触犯法律。那些官吏士卒也常常大力称赞外国的见闻，话说得夸张一点的人就被授予正使，话说得谨慎一点的人就被授予副使，所以那些胡说八道、道德败坏的人都争相仿效。那些出使的人出身都很贫穷，将朝廷赠送给西域各国的礼物据为己有，打算低价出售给外国以谋取私利。外国人也讨厌汉朝的使者各执一词、轻重不一，揣度汉朝军队相距太远，鞭长莫及，于是断绝了汉朝使者的食物以此刁难。汉朝使者因为食物断绝而积怨，以至于相互攻击。楼兰、姑师是小国，处于交通要道之上，攻击劫持汉朝使者王恢等尤其厉害。而匈奴的偷袭骑兵更是经常拦击出使西域的使者。使者争相控诉外国的危害，虽然也有城镇，但是兵力薄弱，容易攻取。于是，天子派从骠侯赵破奴率领属国骑兵及各郡的几万名士兵，来到匈河水边，想要进攻匈奴，但是匈奴军队撤走了。第二年，汉军攻打姑师，赵破奴率领七百轻骑兵率先到达，俘获了楼兰王，就这样攻陷了姑师。汉军又挟大胜之余威围困乌孙、大宛等国。返回汉朝后，赵破奴被封为浞野侯。王恢数次出使，吃尽了楼兰的苦头，于是将情况汇报给天子，天子派王恢率领军队辅佐赵破奴击破楼兰，王恢被封为浩侯。于是汉朝在酒泉修筑了望台和碉堡，一直修到玉门关。

乌孙用一千匹马当作聘礼来娶汉朝女子，汉朝派宗室女子江都翁公嫁给乌孙王为妻，乌孙王昆莫立她为右夫人。匈奴也送来一个女子嫁给昆莫，昆莫立她为左夫人。昆莫说“我年老了”，于是让自己的孙子岑娶江都翁主为妻。乌孙盛产马匹，这里富人家能拥有四五千匹马。

起初，汉朝使者出使到了安息，安息王派人率领二万骑兵在东部边界上迎接。东部边界距离安息都城有几千里远。到达王城，要经过几十座城镇，百姓遍布，人口很多。汉朝使者回国，安息也派使者跟着来，看看汉朝领土的广大，还献上了大鸟蛋和黎轩的魔术师。至于大宛西边的小国驩潜、大益，大宛东边的姑师、扜罙、苏薤等国，也都派人跟随汉朝使者来到汉朝，献上礼物并拜见天子。天子非常高兴。

汉朝使者探寻黄河的源头，黄河的河源在于窴，那里的山盛产玉石，使者们采运了玉石回来，天子考察古代的图书，将黄河发源的山命名为昆仑山。

当时皇上多次巡视沿海地区，每次都让外国的客人尽数跟随，只要是人多的大城市就都去经过，还赏赐给他们财物布帛，置办丰厚的酒肴款待，以此来展示汉朝的富有。举行摔角比赛，展示奇妙的游戏和各种奇异的物品，围观的人很多，皇上就大肆赏赐，聚酒成池，挂肉成林，让外国客人参观各地仓库里的储藏物资，以此表现汉朝的博大，让他们倾慕、吃惊不已。至于魔术技巧的增加，摔角和奇妙的游戏每年都有新花样，各种技艺的兴旺，都是从这时开始的。

西北地区的外国使者，越发频繁地往来。大宛以西的国家，都认为自己离汉朝很远，还是那样骄傲放纵，满不在乎，汉朝也无法用武力使他们折服，只能用礼来笼络他们。从乌孙以西到安息这些国家，因为和匈奴很近，匈奴曾经胁迫月氏国，匈奴使者手中拿着单于的一件信物，那么各个国家都要为他提供食物，不敢阻留而让其受一点苦。至于汉朝的使者，自己不出钱就没有食物，自己不买马就没有坐骑。之所以会有这样的情况，就是因为这里离汉朝太远了，而且汉朝又十分富庶，所以一定要出钱才能得到想要的东西，因为他们畏惧匈奴的使者胜过汉朝的使者。大宛附近的国家都用葡萄酿酒，富人家里储藏的酒多的可达一万多石，贮藏年代久的几十年都不会坏。那里的风俗喜欢饮酒，马喜欢吃苜蓿。汉朝使者带回来这些植物的种子，天子就开始在肥沃的土地上种植苜蓿、葡萄。到得到的天马多了，外国的使者来得多了，那离宫别观旁边都种上了葡萄、苜蓿，密密麻麻、一望无际。从大宛以西到安息，各国虽然使用着不一样的语言，但是风俗基本相同，彼此可以相互了解。那里人都是眼窝深陷，胡须浓密，很善于做买卖，锱铢必较。当地风俗中女子地位很高，女子说的话就是丈夫做决定的依据。那里都没有丝和漆，不懂得如何铸造钱币和器皿。直到有汉朝使者和逃亡士卒投降了他们以后，才教给他们制作兵器和器皿的技术。当地人得到了汉朝的黄金、白银，一般都是用来铸造器皿，而不是钱币。

汉朝使者出使西域的多了以后，那些从少年时期就跟着出使国外的大多都向天子进言久了，熟悉了天子，他们和天子说：“大宛在贰师城有好马，但是却被他们藏起来，不肯给汉朝使者。”天子特别喜欢大宛马，听说这件事后很心动，于是就派壮士车令等人带着千金和金马，到大宛国向大宛王换取贰师城的好马。大宛国中已经有很多汉朝的物品，众人商议说：“汉朝距离我们很远，而在盐泽屡次遭遇失败，如果从北边来的话，还会有匈奴侵扰，从南边来的话又缺少水草。并且途中都没有城镇，缺少饮食。汉朝使者每次来几百人来，常常由于缺少食物而有一半以上的人死去，这样的情况下，汉朝怎么能派大批的军队前来呢？他们拿我们没有办法。况且贰师城的马，是大宛的宝马！”于是大宛不肯将马交给汉朝使者。汉朝使者非常生气，破口大骂，用椎将金马砸毁后离开。大宛的贵族官员也很生气地说道：“汉朝的使者太轻视我们了！”他们遣送汉使者离开，命令大宛东边的郁成国将汉朝使者拦下并杀死，将使者的财物都抢走了。这时天子大怒。姚定汉等几位曾经出使过大宛的人说大宛军事力量薄弱，只需三千汉军，用强弓劲弩射杀他们，就能将大宛的军队全都抓了俘虏。因为天子曾经让浞野侯去进攻楼兰，他率领七百名骑兵先到了楼兰，就俘获了楼兰王，所以天子认为姚定汉等人的话是正确的，还想封宠姬李氏为侯，于是封李广利为贰师将军，徵调属国六千名骑兵，还有各郡国品行不佳的少年几万人，由李广利率领前往征讨大宛。天子希望到贰师城获得好马，所以封李广利为“贰师将军”。赵始成任军正，原来的浩侯王恢为军队的向导，而李哆任校尉，掌管军中大事。这一年是太初元年（前104年）。当时关东出现蝗灾，蝗灾蔓延到西边的敦煌。

贰师将军李广利的军队已经向西渡过了盐泽，沿途的小国都惊恐不已，各自坚守城池，不肯供给食物。汉军攻打它们，却无法攻下。攻下城来就有食物吃，攻不下的，过几天就得撤走。等到了郁成，汉军士兵已经只有几千人了，而且都饥饿疲惫。汉军攻打郁成，被郁成军队击败，汉军伤亡惨重。贰师将军李广利和李哆、赵始成等人商议：“到了郁成都没能够攻下，更何况他们的国都？”于是率军撤回，这一去一回就花费了两年的时间。汉军返回敦煌的时候，士兵已经不足出发时的十分之一二。李广利派出使者去向天子报告：“道路遥远，粮草匮乏。而且士兵们怕的不是打仗，而是饥饿。汉军人少，无法攻克大宛。希望暂时退兵，增派军队再去讨伐。”天子听后很生气，就派使者把守玉门关，说擅自进入玉门关的军士立即处死！贰师将军李广利非常害怕，只好滞留在敦煌。

那年夏天，汉朝在与匈奴的作战中损失了两万多浞野侯的士卒。公卿和议事的大臣都希望停止进攻大宛，集中力量攻打匈奴。天子认为，既然已经攻打大宛，那么连大宛的小国都打不下来，大夏等国就会看不起汉朝，而大宛的良马也绝不会得到，乌孙、仑头更会欺辱汉朝使者，被外国所耻笑了。天子于是就查办了说攻打大宛不利的邓光等人，又赦免囚犯和武官，又增调品行不佳的少年以及边地骑兵，准备了一年多的时间，汉军从敦煌出发的就多达六万人，这还没有将自带装备自愿从军的人包括在内。这些士兵携带十万头牛，三万多匹马，驴、骡、骆驼数以万计。汉军还带了很多粮食，兵器、弓弩都很齐备。当时全天下都为之骚动不安，相互转告奉命攻打大宛，军队总共有五十多名校尉。大宛都城中没有水井，饮水都要汲取城外的流水，于是汉军派水工改变了城的水道，让城内无水可用。汉朝还增调了十八万甲兵到酒泉、张掖北边，设置居延、休屠两个县以拱卫酒泉。汉朝又调遣全国七种犯罪的人，运送干粮供给贰师将军的军队。转运物资的人络绎不绝，一直到敦煌。又任命两位熟习马匹的人做执驱校尉，准备攻克大宛后好挑选良马。

就这样，贰师将军李广利再次出征，由于士兵很多，所以经过的小国没有不迎接的，纷纷都给汉军献上食物。汉军抵达仑头，仑头国不肯投降，攻打几天以后，仑头城坡，汉军大肆屠杀。此后再向西去，汉军没有遇到什么阻拦而顺利到达大宛王城，这时汉军有三万人。大宛军队迎战汉军，汉军射箭将其打败，大宛军队逃回城里，凭城坚守，贰师将军的军队准备攻打郁成，又担心停滞不前会让大宛想出什么诡诈的办法，于是先到大宛城，挖开它的水源引到别的地方，大宛深受其害。汉军将大宛城包围，攻打了四十多天，外围城墙毁坏，大宛贵族官员中的勇将煎靡被俘。大宛人非常害怕，都逃到了中城。大宛贵族官员一起商量对策，说道：“汉朝之所以进攻大宛，就是因为大宛王毋寡藏匿了良马，还杀死了汉朝使者。现在如果杀了大宛王毋寡，再献出良马，汉军就会解围离开；如果汉军不解围离开，那我们再奋力战斗而死也不晚。”大宛的贵族官员们都认为有道理，于是一起将国王毋寡杀死，派出其中一位贵族官员拿着国王的头到贰师将军李广利那里，和他约定说：“汉军不要攻打我们。我们献出所有良马，任由你们挑选，还为汉军提供食物。如果汉军不同意，我们就把良马全部杀掉，而康居的救兵也快要到了。救兵一来，我们在里面，康居军队在外面，内应外合同汉军作战。希望汉军仔细考虑我们的建议，怎么样？”这时，康居的侦察兵也打探到汉军的情况，见汉军还非常强盛，也不敢再前进。贰师将军李广利和赵始成、李哆等人商量说：“听说大宛城内刚找到了汉人，懂得挖井，此外他们城中的粮食还有很多。我们之所以来到这里，就是为了诛杀罪大恶极的毋寡。如今毋寡的头已经在这了，如果这样而还不答应撤围，那么他们就顽强抵抗坚守，而康居的军队等到汉军疲乏就会救援大宛，肯定会打败我们。”汉军的军官都认为是这样的道理，于是同意了大宛的要求。于是大宛献出他们的良马，让汉人自己来挑选，又拿出很多食物送给汉军。汉军挑走了几十匹良马，以及中等以下的公马和母马三千多匹，还立了大宛贵族中一位以前与汉使者关系和善的名叫昧蔡的人为大宛王，和他订立盟约撤兵而还。汉军始终也没有进入大宛的中城，就撤军回了汉朝。

起初，贰师将军李广利从敦煌西边出发时，认为人员太多，沿途的国家无法供给充足的食物，于是兵分几路，分别从南、北两路前进。校尉王申生、原鸿胪壶充国等率领一千多人，从另一条路去了郁成。郁成人坚守城池，拒绝为汉军提供食物。王申生离开大部队二百里远，自恃有大军做后盾而轻视郁成，责备郁成不提供粮草。郁成人拒绝献出粮食，又侦查到王申生的军中人数每天都在减少，就在一天早晨，出动三千人突袭汉军，将王申生等人杀死。汉军大败，只有几个人逃了出来，跑到了贰师将军李广利那里。李广利命令搜粟都尉上官桀率军前去打败郁成。郁成王逃到了康居，上官桀追击到康居。康居人听说汉军已经攻克了大宛，于是把郁成王献给上官桀，上官桀命令四名骑兵把郁成王捆好，押解到贰师将军那里。四名骑兵彼此商议道：“郁成王是汉朝最为痛恨的人，如果途中逃走的话，就耽误大事了。”他们想要杀了郁成王，但是没人敢先下手。上邽骑士赵弟年纪最小，他拔剑砍去，将郁成王杀死，带上他的人头。赵弟、上官桀等人追赶上了贰师将军的大部队。

起初，贰师将军再次出兵大宛时，天子曾派使者告诉乌孙，要求他们多派兵力和汉军联合进攻大宛。乌孙派出二千名骑兵，却持观望态度，不肯前进。贰师将军李广利胜利东归，沿途的那些小国听说大宛被破，都派出子弟跟着汉军到汉朝进贡，拜见皇上，顺便留在汉朝作人质。贰师将军李广利征讨大宛，军正赵始成奋力作战，功劳最大；上官桀勇敢地深入作战，李哆多次出谋划策，所以汉军班师进入玉门关时还有一万多人，战马有一千多匹。贰师将军第二次出兵，军中并不缺乏粮食，战死的人也不算多，但是他手下的官吏都十分贪婪，大都不爱惜士兵，侵吞军饷，所以死的人很多。天子因为他们是万里远征大宛，并没有追究他们的过错，封李广利为海西侯。又封亲自斩杀郁成王的骑兵赵弟为新畤侯。任命军正赵始成为光禄大夫，上官桀为少府，李哆为上党太守。军官中位列九卿的有三人，任诸侯相、郡守、二千石的有一百多人，任一千石以下的有一千多人。对于自愿参军的人的封赏都超过他们的预期，因为犯罪而征召去当兵的人都被赦免罪行，不计功劳。赏赐士卒共四万金。汉军两次攻打大宛，一共享了四年才宣告结束。

汉军已经讨伐大宛，便立昧蔡为大宛王后离去。一年多以后，大宛的贵族官员们认为昧蔡善于阿谀讨好，才导致自己的国家惨遭屠杀，于是一同将昧蔡杀死，立毋寡的兄弟名叫蝉封的为大宛王，并派他的儿子到汉朝作人质。汉朝于是派出使者赠送礼物，来收买安抚大宛国。

汉朝派出十几批使者到大宛以西的那些国家，搜求奇异之物，也借着这个机会宣扬、炫示汉天子征伐大宛的威风和德行。汉朝在郭煌设置酒泉都尉，向西一直到盐水，路上大多修了亭鄣。而仑头有屯田士卒几百人，又在那里设立使者，以保护田地，积蓄粮食，以供给出使外国的人。

太史公说：《禹本纪》说“黄河源自昆仑山。昆仑山高达二千五百多里，是太阳、月亮交相隐蔽，放出光明的地方。山上有礼泉、瑶池”。如今自从张骞出使大夏以后，探寻到了黄河的源头，从哪里能看见本纪上所说的昆仑山呢？所以谈论九州山川，还是《尚书》的说法更接近于事实。至于《禹本纪》《山海经》所记载的奇怪之物，我不敢谈论。