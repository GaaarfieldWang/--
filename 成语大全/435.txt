公元231年，诸葛亮再次出兵祁山，与魏军对峙于渭水南岸。

	诸葛亮设下计策，由魏延引诱司马懿出寨进入上方谷，利用上方谷怪异的地形条件消灭魏军。诸葛亮在上方谷布下伏兵，等司马懿进入上方谷，便火烧上方谷，魏兵无路逃脱。但就在这时，狂风大作，骤雨倾盆，浇灭了满谷大火，司马懿父子绝处逢生。诸葛亮见上方谷内火光冲天，以为司马父子此番必死无疑，却不料功亏一篑。

	司马懿逃回营寨后坚守不出，任凭蜀军挑战，始终不出。诸葛亮夙兴夜寐，殚尽竭虑，终于积劳成疾，昏倒在地。他知道自己时日不多，叫来姜维、马岱，传授兵法和锦囊妙计。又吩咐杨仪：“我死之后，不要发丧，可以做一个大龛，将我的尸体放在龛中，嘴里放入米粒，脚下点一盏长明灯。军中一切照常，让后面的营寨先撤退，然后一营一营缓缓而退，不要急躁。如果司马懿来追，你可布成阵势，摇旗击鼓。等他来到，就将先前雕刻的我的木像放在车上，推到队伍前面，命令将士们分列左右。司马懿见了肯定会惊吓而走。”一一布置妥当，当夜，诸葛亮就去世了。

	姜维、杨仪遵照孔明遗命，不敢举哀，将尸体安置在龛中，命令心腹壮士三百人守护，然后传令各处营寨一一退去。

	诸葛亮逝世前不久，曾派使者去见司马懿。司马懿只向使者问一些饮食起居情况，司马懿听后对旁边人说：“诸葛亮大概不久于人世了。”这时，有人向司马懿报告诸葛亮已经死了，司马懿随即下令起兵追击。刚出寨门，又生疑虑：“孔明善用计谋，莫非他见我不出战，故意以死诈我出来。我若贸贸然追击，肯定中他的计。”于是又勒马回寨，只令夏侯霸带领数十骑，到蜀军驻地探听消息。

	夏侯霸探得确切消息，赶紧报告说：“蜀军全部退走了。”司马父子率军直奔蜀寨，果然已空无一人。司马懿引军在前，追到山脚下，远远望见蜀兵，于是奋力追赶。忽然，背后喊声大震，姜维命杨仪举旗鸣鼓，树影中飘出大旗，上面写着：“汉丞相武乡侯诸葛亮。”司马懿大惊失色，再定睛一看，只见数十员大将，拥出一辆四轮马车来，车上端坐着的竟是诸葛亮。司马懿惊呼：“孔明还活着，我中计了。”回头便逃。姜维从背后杀出来，魏兵魂飞魄散，丢盔弃甲，死伤无数。司马懿一口气跑了五百余里，仍惊魂不定。蜀军从容撤退。

	过了几日，老百姓中传出，诸葛亮确实死了，车上坐着的是木人，都嘲笑司马懿：“死诸葛吓走了生仲达。”这话传到司马懿耳朵里，他自嘲说：“我只会料定生人的事，哪里能料定他的死啊。”

	后来，“死诸葛走生仲达”这一成语，用来借指用死人吓唬活人。

	成语出自：《三国志·诸葛亮传》裴松之注